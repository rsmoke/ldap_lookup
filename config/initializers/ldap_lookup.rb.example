# LDAP Lookup Configuration
# Copy this file to config/initializers/ldap_lookup.rb and configure with your credentials
#
# IMPORTANT: Never commit credentials to version control!
# Use environment variables or a secrets management system.

LdapLookup.configuration do |config|
  # LDAP Server Configuration
  config.host = ENV.fetch('LDAP_HOST', 'ldap.umich.edu')
  config.port = ENV.fetch('LDAP_PORT', '389')
  config.base = ENV.fetch('LDAP_BASE', 'dc=umich,dc=edu')

  # Authentication (optional for anonymous binds)
  # Option 1: Use a service account (recommended for production)
  # Request a service account from your IT department
  # Leave unset to use anonymous binds (if your LDAP server allows it)
  config.username = ENV['LDAP_USERNAME']
  config.password = ENV['LDAP_PASSWORD']

  # Option 2: If your service account uses a custom bind DN format, specify it:
  # config.bind_dn = ENV['LDAP_BIND_DN']
  # Example: cn=service-account,ou=Applications,o=services
  # (If bind_dn is not set, it defaults to: uid=username,ou=People,base)

  # Encryption - REQUIRED (as of Jan 20, 2026)
  # Use :start_tls for port 389 or :simple_tls for LDAPS on port 636
  encryption_method = ENV.fetch('LDAP_ENCRYPTION', 'start_tls').to_sym
  config.encryption = encryption_method

  # Optional: Attribute Configuration
  config.dept_attribute = ENV.fetch('LDAP_DEPT_ATTRIBUTE', 'umichPostalAddressData')
  config.group_attribute = ENV.fetch('LDAP_GROUP_ATTRIBUTE', 'umichGroupEmail')

  # Optional: Diagnostic UID (used by LdapLookup.test_connection)
  # config.diagnostic_uid = ENV['LDAP_DIAGNOSTIC_UID']

  # Optional: Logger for debug output (responds to debug/info or call)
  # Debug output is only emitted when config.debug is true.
  # config.logger = Rails.logger

  # Optional: Separate search bases for users and groups
  # Example for UM service accounts:
  # config.user_base = ENV.fetch('LDAP_USER_BASE', 'ou=people,dc=umich,dc=edu')
  # config.group_base = ENV.fetch('LDAP_GROUP_BASE', 'ou=user groups,ou=groups,dc=umich,dc=edu')
end
